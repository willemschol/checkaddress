<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Prueba M√∫ltiples √Åreas</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style> 
    body, html { height:100%; margin:0; }
    #map { height:100%; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
  <script>
    // 2. Inicializa el mapa (no importa d√≥nde, luego haremos fitBounds)
    const map = L.map('map').setView([-33.5, -70.7], 8);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OSM'
    }).addTo(map);

    // 3. Grupo para todas las √°reas
    const group = L.featureGroup().addTo(map);

    // 4. Carga y dibuja
    fetch('coords.json')
      .then(r => r.json())
      .then(data => {
        console.log('üîç IDs en JSON:', data.map(a=>a.id));

        data.forEach(area => {
          console.log('‚û° Dibujando:', area.id);

          // convierte a [lat, lon] num√©ricos
          const latlngs = area.coordinates.map(c => [
            parseFloat(c.Latitud),
            parseFloat(c.Longitud)
          ]);

          // a√±ade el pol√≠gono
          const poly = L.polygon(latlngs, {
            color: '#'+Math.floor(Math.random()*16777215).toString(16),
            fillOpacity: 0.2
          });
          poly.bindTooltip(area.id);
          group.addLayer(poly);

          // opcional: comprueba r√°pido con Turf que no haya error
          try {
            const turfCoords = latlngs.map(p => [p[1], p[0]]);
            turf.polygon([turfCoords]);
          } catch(e) {
            console.error('‚ùå Turf error en', area.id, e);
          }
        });

        // 5. Ajusta la vista para incluir todas las √°reas
        console.log('üìê Ajustando bounds de grupo:', group.getBounds());
        map.fitBounds(group.getBounds());
      })
      .catch(err => console.error('‚ö†Ô∏è Fetch coords.json:', err));
  </script>
</body>
</html>
